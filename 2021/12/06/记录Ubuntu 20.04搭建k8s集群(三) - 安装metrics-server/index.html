<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(ä¸‰) - å®‰è£…metrics-server | JÂ·Wolf</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="è¿™æ¬¡å˜äº†ğŸ˜„ï¼Œæ–‡æ¡£ä¸‹é¢è¯¦è¯´ä¸‹ï¼Œå¼ºè°ƒä¸€ä¸‹å½“å‰èƒŒæ™¯ï¼š  è¿™æ˜¯åŸºäºä¹‹å‰çš„æ­å»ºæƒ…å†µä¸‹è¿›è¡Œçš„ï¼Œæ¡ä»¶æœ‰é™ï¼Œæˆ‘ä»¬å½“å‰ä½¿ç”¨çš„æ˜¯å•èŠ‚ç‚¹é›†ç¾¤(åªæœ‰ä¸€ä¸ªmasterï¼Œæ—¢å½“æ§åˆ¶é¢åˆå½“å·¥ä½œèŠ‚ç‚¹)ã€‚  æˆ‘ä¸Metrics Serverçš„é‚£ç‚¹äº‹ æœ¬æ¥æ˜¯ä¸æƒ³å…ˆæ•´metricsçš„ï¼Œdashboardå¼„å¥½äº†ï¼Œæœ¬æ¥æŒºèˆ’æœçš„ï¼Œåˆå»dashboardä»“åº“è½¬äº†ä¸€åœˆï¼Œçœ‹åˆ°äº†ä¸‹é¢è¿™å¼ å›¾ï¼Œç„¶åå°±å‘ç°ï¼Œæˆ‘çš„CPU Usage å’ŒMemory Us">
<meta property="og:type" content="article">
<meta property="og:title" content="è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(ä¸‰) - å®‰è£…metrics-server">
<meta property="og:url" content="https://justajwolf.github.io/blog/2021/12/06/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4(%E4%B8%89)%20-%20%E5%AE%89%E8%A3%85metrics-server/index.html">
<meta property="og:site_name" content="JÂ·Wolf">
<meta property="og:description" content="è¿™æ¬¡å˜äº†ğŸ˜„ï¼Œæ–‡æ¡£ä¸‹é¢è¯¦è¯´ä¸‹ï¼Œå¼ºè°ƒä¸€ä¸‹å½“å‰èƒŒæ™¯ï¼š  è¿™æ˜¯åŸºäºä¹‹å‰çš„æ­å»ºæƒ…å†µä¸‹è¿›è¡Œçš„ï¼Œæ¡ä»¶æœ‰é™ï¼Œæˆ‘ä»¬å½“å‰ä½¿ç”¨çš„æ˜¯å•èŠ‚ç‚¹é›†ç¾¤(åªæœ‰ä¸€ä¸ªmasterï¼Œæ—¢å½“æ§åˆ¶é¢åˆå½“å·¥ä½œèŠ‚ç‚¹)ã€‚  æˆ‘ä¸Metrics Serverçš„é‚£ç‚¹äº‹ æœ¬æ¥æ˜¯ä¸æƒ³å…ˆæ•´metricsçš„ï¼Œdashboardå¼„å¥½äº†ï¼Œæœ¬æ¥æŒºèˆ’æœçš„ï¼Œåˆå»dashboardä»“åº“è½¬äº†ä¸€åœˆï¼Œçœ‹åˆ°äº†ä¸‹é¢è¿™å¼ å›¾ï¼Œç„¶åå°±å‘ç°ï¼Œæˆ‘çš„CPU Usage å’ŒMemory Us">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://justajwolf.github.io/images/k8s/dashboard-sample.jpg">
<meta property="article:published_time" content="2021-12-06T03:50:34.000Z">
<meta property="article:modified_time" content="2024-02-18T06:08:53.140Z">
<meta property="article:author" content="CBH">
<meta property="article:tag" content="k8s">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://justajwolf.github.io/images/k8s/dashboard-sample.jpg">
  
  
    <link rel="shortcut icon" href="../../../../favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="../../../../css/style.css">

  
    
<link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.1.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
<img id="avatar" alt="jwolf-logo" border="2"
        src="data:image/png;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/4gIoSUNDX1BST0ZJTEUAAQEAAAIYAAAAAAIQAABtbnRyUkdCIFhZWiAAAAAAAAAAAAAAAABhY3NwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAA9tYAAQAAAADTLQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAlkZXNjAAAA8AAAAHRyWFlaAAABZAAAABRnWFlaAAABeAAAABRiWFlaAAABjAAAABRyVFJDAAABoAAAAChnVFJDAAABoAAAAChiVFJDAAABoAAAACh3dHB0AAAByAAAABRjcHJ0AAAB3AAAADxtbHVjAAAAAAAAAAEAAAAMZW5VUwAAAFgAAAAcAHMAUgBHAEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFhZWiAAAAAAAABvogAAOPUAAAOQWFlaIAAAAAAAAGKZAAC3hQAAGNpYWVogAAAAAAAAJKAAAA+EAAC2z3BhcmEAAAAAAAQAAAACZmYAAPKnAAANWQAAE9AAAApbAAAAAAAAAABYWVogAAAAAAAA9tYAAQAAAADTLW1sdWMAAAAAAAAAAQAAAAxlblVTAAAAIAAAABwARwBvAG8AZwBsAGUAIABJAG4AYwAuACAAMgAwADEANv/bAEMAUDc8RjwyUEZBRlpVUF94yIJ4bm549a+5kcj////////////////////////////////////////////////////bAEMBVVpaeGl464KC6//////////////////////////////////////////////////////////////////////////AABEIAZABkAMBIgACEQEDEQH/xAAZAAEBAQEBAQAAAAAAAAAAAAAAAQIDBAX/xAAwEAEBAAECBQIGAQQCAwEAAAAAAQIDERIhMUFRBGETIlJxgZEyFCNCoTNiNJLRsf/EABYBAQEBAAAAAAAAAAAAAAAAAAABAv/EABcRAQEBAQAAAAAAAAAAAAAAAAARASH/2gAMAwEAAhEDEQA/AM1it1igzWa1WaCAAEFgCKgIioAgAAAAAAAAAAAA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"
      >
      <h1 id="logo-wrap">
        <a href="../../../../index.html" id="logo">JÂ·Wolf</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="../../../../index.html">ä¸»é¡µ</a>
        
          <a class="main-nav-link" href="../../../../archives">å½’æ¡£</a>
        
          <a class="main-nav-link" target="_blank" rel="noopener" href="https://github.com/justajwolf">GitHub</a>
        
      </nav>
      <nav id="sub-nav">
        
        
        <a class="nav-icon nav-search-btn" title="æœç´¢"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="æœç´¢"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://justajwolf.github.io/blog"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(ä¸‰) - å®‰è£…metrics-server" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="" class="article-date">
  <time class="dt-published" datetime="2021-12-06T03:50:34.000Z" itemprop="datePublished">2021-12-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="../../../../categories/k8s/">k8s</a>/<a class="article-category-link" href="../../../../categories/ubuntu/">ubuntu</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(ä¸‰) - å®‰è£…metrics-server
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p> è¿™æ¬¡å˜äº†ğŸ˜„ï¼Œæ–‡æ¡£ä¸‹é¢è¯¦è¯´ä¸‹ï¼Œå¼ºè°ƒä¸€ä¸‹å½“å‰èƒŒæ™¯ï¼š</p>
<ul>
<li>è¿™æ˜¯åŸºäºä¹‹å‰çš„æ­å»ºæƒ…å†µä¸‹è¿›è¡Œçš„ï¼Œæ¡ä»¶æœ‰é™ï¼Œæˆ‘ä»¬å½“å‰ä½¿ç”¨çš„æ˜¯å•èŠ‚ç‚¹é›†ç¾¤(åªæœ‰ä¸€ä¸ªmasterï¼Œæ—¢å½“æ§åˆ¶é¢åˆå½“å·¥ä½œèŠ‚ç‚¹)ã€‚</li>
</ul>
<h2 id="æˆ‘ä¸Metrics-Serverçš„é‚£ç‚¹äº‹"><a href="#æˆ‘ä¸Metrics-Serverçš„é‚£ç‚¹äº‹" class="headerlink" title="æˆ‘ä¸Metrics Serverçš„é‚£ç‚¹äº‹"></a>æˆ‘ä¸Metrics Serverçš„é‚£ç‚¹äº‹</h2><ul>
<li><p>æœ¬æ¥æ˜¯ä¸æƒ³å…ˆæ•´metricsçš„ï¼Œdashboardå¼„å¥½äº†ï¼Œæœ¬æ¥æŒºèˆ’æœçš„ï¼Œåˆå»dashboardä»“åº“è½¬äº†ä¸€åœˆï¼Œçœ‹åˆ°äº†ä¸‹é¢è¿™å¼ å›¾ï¼Œç„¶åå°±å‘ç°ï¼Œæˆ‘çš„CPU Usage å’ŒMemory Usageå‘¢ï¼Ÿï¼Ÿï¼Ÿ</p>
<p><img src="/images/k8s/dashboard-sample.jpg"></p>
</li>
<li><p>ç„¶åGoogleä¸€ä¸‹ï¼Œï¼Œï¼Œæœ‰äººè¯´æ˜¯Metrics APIæœ‰é—®é¢˜ï¼Œå°±å»çœ‹äº†ä¸€ä¸‹ï¼Œdashboard-metrics-scraperæ—¥å¿—ï¼Œæœç„¶ã€‚ã€‚ã€‚k8sè‡ªå·±æœ¬èº«api server ä¸æä¾›Metricsæ•°æ®æŒ‡æ ‡æ•´åˆæ¥å£å®ç°ã€‚ã€‚ã€‚kubectl top å‘½ä»¤ä¹Ÿæ˜¯æ˜¾ç¤º<code> error: metrics not available yet</code>ã€‚ã€‚</p>
</li>
<li><p>æ²¡åŠæ³•ï¼Œé‚£æ•´ä¸€ä¸‹Metrics Serverå§ğŸ˜”</p>
</li>
</ul>
<h2 id="ä»”ç»†åˆ†æä¸€æ³¢æ–‡æ¡£"><a href="#ä»”ç»†åˆ†æä¸€æ³¢æ–‡æ¡£" class="headerlink" title="ä»”ç»†åˆ†æä¸€æ³¢æ–‡æ¡£"></a>ä»”ç»†åˆ†æä¸€æ³¢æ–‡æ¡£</h2><ul>
<li><p>k8så®˜æ–¹æ–‡æ¡£ä¸­Metrics API ç›¸å…³ä»‹ç»ï¼Œ<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/debug-application-cluster/resource-metrics-pipeline/">è¯¦è§</a></p>
<ul>
<li><p>API Serveræ²¡æœ‰æä¾›Metrics APIçš„å…·ä½“å®ç°ï¼Œk8såªæä¾›äº†ä¸€å¥—APIå®šä¹‰ä¾›ç›¸å…³ç¬¬ä¸‰æ–¹å·¥å…·å»è‡ªå·±å®ç°ç›¸å…³æŒ‡æ ‡æ•´åˆï¼Œå¹¶å°†Metricsæ¥å£æœåŠ¡æ³¨å†Œåˆ°API Serverã€‚</p>
</li>
<li><p>å®ç°Metrics APIçš„æŒ‡æ ‡é‡‡é›†å·¥å…·ï¼Œç›®å‰æˆ‘äº†è§£åˆ°çš„æ˜¯ä¸‹é¢è¿™ä¿©ï¼š</p>
<ul>
<li><p>Prometheusï¼šè¿™ä¸ªä¹‹å‰æœ‰ä½¿ç”¨è¿‡ï¼Œæ­é…Alertmanagerå’ŒGrafanaï¼ŒåšæœåŠ¡é¢„è­¦å’ŒæŒ‡æ ‡ç›‘æ§ï¼Œå°±æ„Ÿè§‰æŒºçˆ½ã€‚</p>
</li>
<li><p>Metrics Serverï¼šè¿™ä¸ªçœ‹æ–‡æ¡£è¯´çš„å¥½åƒæ˜¯æ²¡æœ‰Prometheusä¸“ä¸šï¼Œä¹Ÿä¸æ¨èPrometheusç›´æ¥ä½¿ç”¨å®ƒçš„æŒ‡æ ‡æ•°æ®ï¼Œå› ä¸ºå®ƒçš„æ•°æ®æ˜¯å®æ—¶çš„æ²¡æœ‰æä¾›æŒä¹…åŒ–(è¿™é‡Œæˆ‘å°±ç†è§£å®ƒä¸ºè½»é‡ä¸€ç‚¹å§ğŸ˜„)ã€‚</p>
</li>
</ul>
</li>
<li><p>ä¸ºäº†è®©dashboardèƒ½é‡‡é›†åˆ°nodeå’Œpodçš„ç›¸å…³æŒ‡æ ‡ï¼Œä»¥åŠkubectl topå¯ä»¥ä½¿ç”¨ï¼Œå°±æ€ä¹ˆç®€å•æ€ä¹ˆæ¥ï¼Œé€‰æ‹©Metrics serverä½œä¸ºMetrics APIå®ç°serverã€‚</p>
</li>
</ul>
</li>
<li><p>Metrics Serverä»“åº“åœ°å€ [<a target="_blank" rel="noopener" href="https://github.com/kubernetes-sigs/metrics-server">-&gt;æˆ³è¿™&lt;-</a>]ï¼Œä¸‹é¢æˆ‘ä»¬æ¥ç®€è¿°ä¸€ä¸‹ï¼Œå¯¹æˆ‘ä»¬æœ‰ç”¨çš„æ–‡æ¡£å†…å®¹ï¼š</p>
<ul>
<li><p>å®‰è£…å‰ç½®æ¡ä»¶</p>
<ul>
<li><p>Metrics Serveråˆ°API serverçš„ç½‘ç»œæ˜¯å¯ä»¥è®¿é—®çš„ã€‚</p>
</li>
<li><p>k8s API Serveræ˜¯å¼€å¯èšåˆå±‚é…ç½®çš„ï¼Œ<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tasks/extend-kubernetes/configure-aggregation-layer/">è¯¦è§</a>ã€‚</p>
<ul>
<li>è¿™å—ä¸»è¦æ˜¯åŒå‘é‰´æƒç›¸å…³çš„å†…å®¹(å³ä»client request &#x3D;&gt; api server &#x3D;&gt; metrics serverä¹‹é—´çš„åŒå‘é‰´æƒ)ã€‚</li>
</ul>
</li>
<li><p>éœ€è¦å¼€å¯Kubelet è®¤è¯&#x2F;é‰´æƒï¼Œ<a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet-authentication-authorization/">è¯¦è§</a>ï¼Œè¿™ä¸ªåº”è¯¥åˆ›å»ºé›†ç¾¤çš„æ—¶å€™ï¼Œä¸ç‰¹æ®ŠæŒ‡å®šï¼Œé»˜è®¤å¼€å¯çš„ï¼š</p>
<ul>
<li><p>è¿™å—ä¸»è¦æ˜¯ metrics server &#x3D;&gt; kubelet æä¾›çš„æŒ‡æ ‡é‡‡é›†api ä¹‹é—´çš„é‰´æƒã€‚</p>
</li>
<li><p>kubeleté»˜è®¤å·¥ä½œç›®å½•ï¼š&#x2F;var&#x2F;lib&#x2F;kubelet</p>
</li>
<li><p>æŸ¥çœ‹é…ç½®æ–‡ä»¶&#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;config.yamlï¼Œå¯è§webhookæ˜¯å¼€å¯çš„ï¼Œå¹¶ä¸”ä½¿ç”¨çš„x509è®¤è¯ï¼Œè¯ä¹¦å°±æ˜¯é›†ç¾¤è‡ªç­¾çš„ca.crt</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æœ‰ç‚¹é•¿ï¼Œè¿™é‡Œä¹‹æŸ¥çœ‹å‰15è¡Œå†…å®¹</span></span><br><span class="line">head --line 15 config.yaml</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">authentication:</span><br><span class="line">  anonymous:</span><br><span class="line">    enabled: false</span><br><span class="line">  webhook:</span><br><span class="line">    cacheTTL: 0s</span><br><span class="line">    enabled: true</span><br><span class="line">  x509:</span><br><span class="line">    clientCAFile: /etc/kubernetes/pki/ca.crt</span><br><span class="line">authorization:</span><br><span class="line">  mode: Webhook</span><br><span class="line">  webhook:</span><br><span class="line">    cacheAuthorizedTTL: 0s</span><br><span class="line">    cacheUnauthorizedTTL: 0s</span><br><span class="line">cgroupDriver: systemd</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>kubeletä½¿ç”¨çš„caéœ€è¦æ˜¯é›†ç¾¤çš„caï¼Œè¿™ä¸ªç¡®å®æ˜¯é›†ç¾¤çš„caï¼Œä¸Šé¢çš„clientCAFile: &#x2F;etc&#x2F;kubernetes&#x2F;pki&#x2F;ca.crtå°±æ˜¯é›†ç¾¤çš„caï¼Œ</p>
<ul>
<li>è‡ªç­¾çš„è¿™ä¸ªè¯ä¹¦ä¸Šå¹¶æ²¡æœ‰ç»‘å®šå…·ä½“çš„node ipï¼Œå°±ä¼šäº§ç”Ÿx509æ ¡éªŒä¸è¿‡é—®é¢˜ã€‚</li>
<li>æœ€ç®€å•çš„åŠæ³•ï¼Œåœ¨å¯åŠ¨Metrics Serverå®¹å™¨æ—¶ä½¿ç”¨â€“kubelet-insecure-tlsï¼Œä½¿ç”¨ä¸å®‰å…¨çš„tlsè®¿é—®kubeletçš„æŒ‡æ ‡æ¥å£ã€‚</li>
<li>è¿™ä¸ªx509æ ¡éªŒè¦æ˜¯ä¸è¿‡ï¼ŒMetrics Serveræ˜¯æ²¡åŠæ³•æ³¨å†Œåˆ°API Serverçš„ã€‚</li>
</ul>
</li>
<li><p>å®¹å™¨è¿è¡Œæ—¶ï¼Œéœ€è¦å®ç°<a target="_blank" rel="noopener" href="https://github.com/kubernetes/community/blob/master/contributors/devel/sig-node/cri-container-stats.md">Container Metrics RPCs</a> ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Dockerï¼Œè¿™ä¸ªå…·ä½“æ²¡æœ‰å»ç ”ç©¶ï¼Œä¹Ÿæ˜¯æœ‰ä¸€å¥—APIï¼ŒDockerè‚¯å®šæ˜¯å®ç°äº†ï¼Œä¸ç„¶kubeletä¹Ÿä¸å¯èƒ½é‡‡é›†åˆ°Podçš„æ•°æ®</p>
<ul>
<li>è¿™ä¸ªä¸»è¦æ˜¯kubeletå»é‡‡é›†å½“å‰nodeä¸Šçš„å„ä¸ªpodçš„æŒ‡æ ‡æ•°æ®</li>
</ul>
</li>
</ul>
</li>
<li><p>å®¹å™¨å¯åŠ¨å‚æ•°</p>
<ul>
<li>â€“kubelet-preferred-address-typesï¼šè®¿é—®èŠ‚ç‚¹åœ°å€ï¼Œä¼˜å…ˆä½¿ç”¨é¡ºåºï¼Œé»˜è®¤ï¼š[Hostname, InternalDNS, InternalIP, ExternalDNS, ExternalIP]</li>
<li>â€“kubelet-insecure-tlsï¼šè¿™ä¸ªå°±æ˜¯ä¸Šé¢è¯´çš„ï¼Œå¯ä»¥ä¸æ ¡éªŒcaï¼Œæ–‡æ¡£ä¸Šè¯´ä»…å¯¹æµ‹è¯•ç›®çš„è¿™ä¹ˆç”¨ï¼Œä½†æ˜¯è‡ªå·±å­¦ä¹ ç¯å¢ƒï¼Œä¹Ÿå·®ä¸å¤šã€‚</li>
<li>â€“requestheader-client-ca-fileï¼šæŒ‡å®šä¸€ä¸ªæ ¹è¯ä¹¦æ–‡ä»¶ï¼Œç”¨äºå‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯(ä¹Ÿå°±æ˜¯Metrics Server)çš„éªŒè¯ã€‚</li>
</ul>
</li>
<li><p>æä¾›helmå®‰è£…å’Œyamlæ–‡ä»¶ç›´æ¥å®‰è£…ï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨yamlæ–‡ä»¶å®‰è£…</p>
</li>
</ul>
</li>
</ul>
<h2 id="å¼€å§‹å®‰è£…"><a href="#å¼€å§‹å®‰è£…" class="headerlink" title="å¼€å§‹å®‰è£…"></a>å¼€å§‹å®‰è£…</h2><ul>
<li><p>ä¸‹è½½yamlæ–‡ä»¶, è¿™å—æ–‡æ¡£æä¾›çš„githubåœ°å€ä¸æ˜¯æœ€ç»ˆæ–‡ä»¶åœ°å€ï¼Œéœ€è¦é‡å®šå‘è·³è½¬ï¼Œæ²¡åŠæ³•ä½¿ç”¨jsdelivrè½¬æ¢åœ°å€ï¼Œåªèƒ½ç§‘å­¦ä¸Šäº†ã€‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ‡æ¢ç›®å½•åˆ°è‡ªå®šä¹‰çš„æ’ä»¶ç›®å½•</span></span><br><span class="line">cd ~/.kube/addons</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ç§‘å­¦ä¸Šç½‘ä¸‹è½½</span></span><br><span class="line">curl -o metrics-server.yaml https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml -L</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">ä¿®æ”¹ä¸€ä¸‹metrics-server.yamlæ–‡ä»¶åŠ ä¸Š--kubelet-insecure-tlså‚æ•°</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">åˆ›å»ºmetrics-serverç›¸å…³è´Ÿè½½</span></span><br><span class="line">kubectl apply -f metrics-server.yaml</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹deploymentçŠ¶æ€</span></span><br><span class="line">kctl -n kube-system get deployment.apps/metrics-server</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2><p>Metrics Serverå®‰è£…å®Œäº†ï¼Œå†å»dashboardä¸Šçœ‹çœ‹ï¼ŒCPU usage å’Œ Memory usageæœ‰äº†ï¼Œè¿˜æœ‰éœ€è¦æ³¨æ„å¾—ä¸€ä¸ªåœ°æ–¹ï¼Œè®¿é—®dashboardçš„&#x2F;overviewè·¯å¾„æ˜¯å¯¹åº”çš„ä¸Šé¢çš„é‚£ä¸ªä¾‹å›¾ï¼Œæˆ‘çš„Dashboard v2.4.0+0.ge75ebcf68ï¼Œç‚¹å‡»logoè·³è½¬çš„æ˜¯&#x2F;workloadsï¼Œä¸æ˜¯&#x2F;overviewã€‚ã€‚ã€‚ã€‚åæ­£æ˜¯è®¿é—®&#x2F;overviewå°±å’Œä¸Šé¢é‚£ä¸ªä¾‹å›¾ä¸€æ ·äº†ã€‚ã€‚ğŸ˜„</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://justajwolf.github.io/blog/2021/12/06/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4(%E4%B8%89)%20-%20%E5%AE%89%E8%A3%85metrics-server/" data-id="clsr7q0j30006ddqf1mt37prj" data-title="è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(ä¸‰) - å®‰è£…metrics-server" class="article-share-link"><span class="fa fa-share">åˆ†äº«</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../../../tags/k8s/" rel="tag">k8s</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../07/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4(%E5%9B%9B)%20-%20%E5%AE%89%E8%A3%85ingress%20controller/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">å‰ä¸€ç¯‡</strong>
      <div class="article-nav-title">
        
          è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(å››) - å®‰è£…ingress controller
        
      </div>
    </a>
  
  
    <a href="../../05/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4(%E4%BA%8C)%20-%20Web%E7%95%8C%E9%9D%A2%E4%BB%AA%E8%A1%A8%E7%9B%98(Dashboard)/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">åä¸€ç¯‡</strong>
      <div class="article-nav-title">è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(äºŒ) - Webç•Œé¢ä»ªè¡¨ç›˜(Dashboard)</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">åˆ†ç±»</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/k8s/">k8s</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/ubuntu/">ubuntu</a></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/windows/">windows</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æ ‡ç­¾</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/k8s/" rel="tag">k8s</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/mongodb/" rel="tag">mongodb</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/openvpn/" rel="tag">openvpn</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../../../tags/wsl/" rel="tag">wsl</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">å½’æ¡£</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/12/">åäºŒæœˆ 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/11/">åä¸€æœˆ 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../../../archives/2021/10/">åæœˆ 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">æœ€æ–°æ–‡ç« </h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../../07/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4(%E5%9B%9B)%20-%20%E5%AE%89%E8%A3%85ingress%20controller/">è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(å››) - å®‰è£…ingress controller</a>
          </li>
        
          <li>
            <a href="">è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(ä¸‰) - å®‰è£…metrics-server</a>
          </li>
        
          <li>
            <a href="../../05/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4(%E4%BA%8C)%20-%20Web%E7%95%8C%E9%9D%A2%E4%BB%AA%E8%A1%A8%E7%9B%98(Dashboard)/">è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(äºŒ) - Webç•Œé¢ä»ªè¡¨ç›˜(Dashboard)</a>
          </li>
        
          <li>
            <a href="../../../11/29/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4(%E4%B8%80)%20-%20%E4%BD%BF%E7%94%A8kubeadm%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4/">è®°å½•Ubuntu 20.04æ­å»ºk8sé›†ç¾¤(ä¸€) - ä½¿ç”¨kubeadmåˆ›å»ºé›†ç¾¤</a>
          </li>
        
          <li>
            <a href="../../../11/23/%E8%AE%B0%E5%BD%95Ubuntu%2020.04%E6%90%AD%E5%BB%BAOpenVPN%E6%9C%8D%E5%8A%A1/">è®°å½•Ubuntu 20.04æ­å»ºOpenVPNæœåŠ¡</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 CBH<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">ä¸»é¡µ</a>
  
    <a href="../../../../archives" class="mobile-nav-link">å½’æ¡£</a>
  
    <a target="_blank" rel="noopener" href="https://github.com/justajwolf" class="mobile-nav-link">GitHub</a>
  
</nav>
    


<script src="../../../../js/jquery-3.6.4.min.js"></script>



  
<script src="../../../../fancybox/jquery.fancybox.min.js"></script>




<script src="../../../../js/script.js"></script>





  </div>
</body>
</html>